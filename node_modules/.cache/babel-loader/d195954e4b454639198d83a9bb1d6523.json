{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _Device = require('../Device');\n\nvar _Device2 = _interopRequireDefault(_Device);\n\nvar _logger = require('../logger');\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar logger = new _logger2.default('SSO.LinkedIn');\nvar default_options = {\n  api_key: null,\n  script: 'http://platform.linkedin.com/in.js?async=true'\n  /**\n  * Reference: https://developer.linkedin.com/docs/getting-started-js-sdk\n  */\n\n};\n\nvar LinkedIn = function () {\n  function LinkedIn(options) {\n    _classCallCheck(this, LinkedIn);\n\n    if (typeof options === 'string') {\n      options = {\n        api_key: options\n      };\n    }\n\n    this._options = Object.assign({}, default_options, options);\n\n    if (!this._options.api_key) {\n      logger.warn('missing api_key');\n    }\n\n    this.signIn = this.signIn.bind(this);\n    this.signOut = this.signOut.bind(this);\n    this.check = this.check.bind(this);\n    this.ready = this.ready.bind(this);\n    this._user = this._user.bind(this);\n    this._initIn = this._initIn.bind(this);\n    this._fullyLoaded = this._fullyLoaded.bind(this);\n    this._IN = null;\n    this._INLoaded = false;\n\n    this._createScript();\n  }\n\n  _createClass(LinkedIn, [{\n    key: 'signIn',\n    value: function signIn() {\n      var IN = this._IN;\n\n      if (!IN) {\n        return Promise.reject('no IN instance');\n      }\n\n      var that = this;\n      return new Promise(function (resolve, reject) {\n        IN.User.authorize(function () {\n          that._user().then(function (user) {\n            return resolve(user);\n          }).catch(function (err) {\n            return reject(err);\n          });\n        });\n      });\n    }\n  }, {\n    key: 'signOut',\n    value: function signOut() {\n      var IN = this._IN;\n\n      if (!IN) {\n        return Promise.reject('no IN instance');\n      }\n\n      var that = this;\n      return new Promise(function (resolve, reject) {\n        IN.User.logout(function () {\n          logger.debug('signed out');\n          resolve();\n        });\n      });\n    }\n  }, {\n    key: 'check',\n    value: function check() {\n      var IN = this._IN;\n\n      if (!IN) {\n        return Promise.reject('no IN instance');\n      }\n\n      if (!IN.User.isAuthorized()) {\n        return Promise.reject('not authorized');\n      }\n\n      return this._user();\n    }\n  }, {\n    key: 'ready',\n    value: function ready() {\n      var api_key = this._options.api_key;\n\n      if (!api_key) {\n        return Promise.reject('missing api_key');\n      }\n\n      var that = this;\n      return new Promise(function (resolve, reject) {\n        var checkCount = 0;\n\n        var checkIN = function checkIN() {\n          checkCount++;\n\n          if (that._IN && that._INLoaded) {\n            resolve();\n            return;\n          }\n\n          if (window.IN) {\n            that._initIn();\n\n            return;\n          }\n\n          if (checkCount < 5) {\n            window.setTimeout(checkIN, 500);\n          } else {\n            reject('timeout');\n          }\n        };\n\n        checkIN();\n      });\n    }\n  }, {\n    key: '_user',\n    value: function _user() {\n      var IN = this._IN;\n      return new Promise(function (resolve, reject) {\n        IN.API.Raw('/people/~').result(function (profile) {\n          var firstName = profile.firstName,\n              lastName = profile.lastName,\n              id = profile.id,\n              headline = profile.headline;\n          resolve({\n            id: id,\n            firstName: firstName,\n            lastName: lastName,\n            headline: headline\n          });\n        }).error(function (err) {\n          return reject(err);\n        });\n      });\n    }\n  }, {\n    key: '_createScript',\n    value: function _createScript() {\n      if (window.IN) {\n        this._initIn();\n      }\n\n      var script = this._options.script;\n\n      if (script === 'none') {\n        return;\n      }\n\n      window._in_onload = this._fullyLoaded;\n\n      _Device2.default.createScript(this._options.script, true, this._initIn);\n    }\n  }, {\n    key: '_initIn',\n    value: function _initIn() {\n      logger.debug('init IN');\n      var api_key = this._options.api_key;\n\n      if (!api_key) {\n        logger.warn('missing api_key');\n        return;\n      }\n\n      var IN = window.IN;\n      IN.init({\n        api_key: api_key,\n        authorize: true,\n        onLoad: \"_in_onload\"\n      });\n      this._IN = IN;\n    }\n  }, {\n    key: '_fullyLoaded',\n    value: function _fullyLoaded() {\n      logger.debug('fully loaded');\n      this._INLoaded = true;\n    }\n  }]);\n\n  return LinkedIn;\n}();\n\nexports.default = LinkedIn;","map":null,"metadata":{},"sourceType":"script"}